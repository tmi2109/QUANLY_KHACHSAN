DROP DATABASE QUANLY_KHACHSAN
GO

CREATE DATABASE QUANLY_KHACHSAN
GO

USE QUANLY_KHACHSAN
GO

CREATE TABLE CHUCVU
(
	MACV NCHAR(10) NOT NULL,
	TENCV NVARCHAR(30),
	CONSTRAINT PK_CHUCVU PRIMARY KEY (MACV)
)

CREATE TABLE KHACHHANG
(
	MAKH NCHAR(10) NOT NULL,
	HOTENKH NVARCHAR(40),
	DIACHI NVARCHAR(60),
	GIOITINH NCHAR(10),
	CCCD NVARCHAR(15),
	SDT CHAR(15),
	QUOCTICH NVARCHAR(20),
	CONSTRAINT PK_KHACHHANG PRIMARY KEY (MAKH)
)

CREATE TABLE NHANVIEN
(
	MANV NCHAR(10) NOT NULL,
	TENNV NVARCHAR(40),
	MACV NCHAR(10),
	GIOITINH NCHAR(5),
	NGAYSINH DATE,
	DCHI NVARCHAR(60),
	SDT CHAR(15),
	CONSTRAINT PK_NHANVIEN PRIMARY KEY (MANV),
	CONSTRAINT FK_NHANVIEN_CHUCVU FOREIGN KEY (MACV)  REFERENCES CHUCVU(MACV)

)

CREATE TABLE LOAIPHONG
(
	MALP NCHAR(10) NOT NULL,
	TENLP NVARCHAR(30),
	TRANGBI NVARCHAR(100),
	CONSTRAINT PK_LOAIPHONG PRIMARY KEY (MALP),

)

CREATE TABLE PHONG
(
	MAPHONG NCHAR(10) NOT NULL,
	TENPHONG NVARCHAR(40),
	TINHTRANG NVARCHAR(20),
	MALP NCHAR(10) ,
	GIAPHONG MONEY,
	DVT NVARCHAR(10),
	CONSTRAINT PK_PHONG PRIMARY KEY (MAPHONG),
	CONSTRAINT FK_PHONG_LOAIPHONG FOREIGN KEY (MALP)  REFERENCES LOAIPHONG(MALP)

)

CREATE TABLE HOADON
(
	MAHD NCHAR(10) NOT NULL,
	MAPHONG NCHAR(10) ,
	NGAYTHANHTOAN DATE,
	SOTIENTRATRUOC MONEY,
	DVT NVARCHAR(10),
	MANV NCHAR(10) ,
	CONSTRAINT PK_HOADON PRIMARY KEY (MAHD),
	CONSTRAINT FK_HOADON_NHANVIEN FOREIGN KEY (MANV)  REFERENCES NHANVIEN(MANV),
	CONSTRAINT FK_HOADON_PHONG FOREIGN KEY (MAPHONG)  REFERENCES PHONG(MAPHONG)

)

CREATE TABLE PHIEUDANGKY
(
	MAPDK NCHAR(10) NOT NULL,
	MAKH NCHAR(10),
	MANV NCHAR(10),
	NGAYDAT DATE,
	NGAYDI DATE,
	MAPHONG NCHAR(10),
	TRATRUOC MONEY,
	DVT NVARCHAR(10),
	MAPHIEUDV NCHAR(10),
	CONSTRAINT PK_PHIEUDANGKY PRIMARY KEY (MAPDK),
	CONSTRAINT FK_PHIEUDANGKY_KHACHHANG FOREIGN KEY (MAKH)  REFERENCES KHACHHANG(MAKH),
	CONSTRAINT FK_PHIEUDANGKY_NHANVIEN FOREIGN KEY (MANV)  REFERENCES NHANVIEN(MANV),
	CONSTRAINT FK_PHIEUDANGKY_PHONG FOREIGN KEY (MAPHONG)  REFERENCES PHONG(MAPHONG)
)

CREATE TABLE PHIEUDICHVU
(
	MAPHIEUDV NCHAR(10) NOT NULL,
	MAPDK NCHAR(10) ,
	TENDV NVARCHAR(40),
	GIADV MONEY,
	CONSTRAINT PK_PHIEUDICHVU PRIMARY KEY (MAPHIEUDV),
	CONSTRAINT FK_PHIEUDICHVU_PHIEUDANGKY FOREIGN KEY (MAPDK)  REFERENCES PHIEUDANGKY(MAPDK)
)
GO

SELECT* FROM CHUCVU
INSERT INTO CHUCVU
VALUES 
('GD', N'Giám Đốc'),
('PGD',	N'Phó Giám Đốc'),
('QL', N'Quản Lý'),
('KT', N'Kế Toán'),
('TK', N'Thư Ký'),
('LT', N'Lễ Tân'),
('PV', N'Phục Vụ'),
('BV', N'Bảo Vệ');
GO

SET DATEFORMAT DMY
SELECT* FROM NHANVIEN
INSERT INTO NHANVIEN
VALUES
('NV001', N'Trần Minh Tuấn', 'GD', N'Nam', '23/02/1987', N'30 Lê Thị Hồng, P.17 Q. Gò Vấp, TP.HCM', '0763456723'),
('NV002', N'Nguyễn Quốc Lâm', 'PGD',N'Nam',	'24/04/1985', N'30 Phan Văn Trị, P.12 Q.Gò Vấp, TP.HCM', '0768456345'),
('NV003', N'Lê Thị Nhung', 'QL', N'Nữ', '02/3/1973',N'42 Nơ Trang Long, P.7 Q.Bình Thạnh, TP.HCM', '0763556736'),
('NV004', N'Nguyễn Văn Tài', 'QL', N'Nam', '15/10/1975', N'30 Hoàng Văn Thụ, P.5 Q.Tân Bình, TP.HCM', '0463756444'),
('NV005', N'Nguyễn Thị Hồng Thấm', 'KT', N'Nữ',	'17/05/1982', N'92 Nguyễn Thị Tú, P.10 Q. Bình Tân, TP.HCM', '0623456761'),
('NV006', N'Nguyễn Quốc Toản', 'KT', N'Nam', '23/02/1992', N'30 Lê Đức Thọ, P.6 Q.Gò Vấp, TP.HCM', '0263456710'),
('NV007', N'Phan Trọng Hảo', 'TK', N'Nam', '19/05/1995', N'32 Nguyễn Du P.2 Q.Gò Vấp TP.HCM', '0798712339'),
('NV008', N'Nguyễn Minh Trí', 'TK', N'Nam',	'23/04/1993', N'64 Quang Trung, P.4 Q.Gò Vấp, TP.HCM', '0722719118'),
('NV009', N'Lê Thị Minh', 'LT',	N'Nữ', '19/11/1989', N'123 Nguyễn Văn Lượng, P.6 Q. Gò Vấp, TP.HCM', '0793719334'),
('NV010', N'Cao Văn Tuyên', 'LT', N'Nam', '26/12/1992',	N'32 Tân Sơn, P.7 Q.Gò Vấp, TP.HCM', '0748714322'),
('NV011', N'Phạm Thị Hồng Tuyết', 'LT',	N'Nữ', '19/08/1965', N'32 Nguyễn Kiệm, P.9 Q. Gò Vấp TP.HCM', '0639872555'),
('NV012', N'Nguyễn Hùng', 'PV',	N'Nam', '05/05/1975', N'25 Hải Châu, Đà Nẵng', '0122350305'),
('NV013', N'Nguyễn Hoàng Anh', 'PV', N'Nữ',	'02/02/1985', N'26 Thanh Khê, Đà Nẵng', '0982811127'),
('NV014', N'Nguyễn Anh Thư', 'PV',	N'Nữ', '02/06/1988', N'27 Cái Nước, Cà Mau', '0122350305'),
('NV015', N'Lê Quốc Bảo', 'PV',	N'Nam',	'25/12/1978', N'28 Lai Vung, Đồng Tháp', '0122350305'),
('NV016', N'Nguyễn Hồng Hoa', 'PV',	N'Nữ', '01/02/1985', N'Ấp Bắc, Tiền Giang', '0122350305'),
('NV017', N'Trần Hoàng Minh', 'BV',	N'Nam',	'02/02/1978', N'Ba Tri, Bến Tre', '0122350305'),
('NV018',N'Phan Hữu Lý', 'BV', N'Nam',	'02/07/1983', N'Cam Ranh, Khánh Hòa', '0122350305');
GO

 SELECT* FROM LOAIPHONG
 INSERT INTO LOAIPHONG
 VALUES
('VP',	'VIP1',	N'Máy Lạnh, Tivi, Tủ Đồ, Tủ Lạnh,  Bàn, Giường, Bồn Tắm'),
('VPP',	'VIP2',	N'Máy Lạnh, Tivi, Tủ Đồ, Tủ Lạnh, Bàn, Giường, Bồn Tắm, Dịch Vụ Ăn Uống'),
('BT',	N'THƯỜNG',	N'Máy Lạnh, Tivi, Tủ Đồ, Bàn, Giường');
GO

SELECT* FROM PHONG
INSERT INTO PHONG
VALUES
('VP001', N'Phòng 300', N'Trống','VP','500000','VND'),
('VP002', N'Phòng 301', N'Đã Đặt','VP','500000','VND'),
('VP003', N'Phòng 302', N'Đang Sử Dụng','VP','500000','VND'),
('VP004', N'Phòng 303', N'Trống','VP','500000','VND'),
('VP005', N'Phòng 304', N'Trống','VP','500000','VND'),
('VPP001', N'Phòng 305 Đôi', N'Trống','VPP','400000','VND'),
('PP002', N'Phòng 306 Đôi', N'Đang Sử Dụng','VPP','400000','VND'),
('VPP003', N'Phòng 307 Đôi', N'Trống','VPP','400000','VND'),
('VPP004', N'Phòng 308 Đôi', N'Đang Sử Dụng','VPP','400000','VND'),
('VPP005', N'Phòng 309 Đôi', N'Trống','VPP','400000','VND'),
('BT001', N'Phòng 400',N'Trống','BT','200000','VND'),
('BT002', N'Phòng 401',N'Trống','BT','200000','VND'),
('BT003', N'Phòng 402',N'Đang Sử Dụng','BT','200000','VND'),
('BT004', N'Phòng 403',N'Đang Sử Dụng','BT','200000','VND'),
('BT005', N'Phòng 404',N'Đã Đặt','BT','200000','VND');
GO

SET DATEFORMAT DMY
SELECT* FROM HOADON
INSERT INTO HOADON
VALUES
 ('HD001','BT005', '03/04/2020', '300000','VND','NV001'),
 ('HD002','BT001', '03/04/2021', '200000','VND','NV001'),
 ('HD003','BT003', '03/04/2020', '200000','VND','NV001'),
 ('HD004','VPP004', '05/10/2021', '600000','VND','NV002'),
 ('HD005','VP002', '14/05/2019', '400000','VND','NV002'),
 ('HD006','VPP005', '06/01/2021', '550000','VND','NV003'),
 ('HD007','BT004', '20/02/2020', '300000','VND','NV003'),
 ('HD008','BT002', '03/01/2021', '300000','VND','NV004'),
 ('HD009','VPP005', '20/03/2018', '500000','VND','NV004'),
 ('HD0010','BT001', '25/03/2018','350000','VND','NV005'),
 ('HD0011','BT002', '25/03/2019','350000','VND','NV005');
 GO

SET DATEFORMAT DMY
SELECT* FROM KHACHHANG
INSERT INTO KHACHHANG
VALUES
('KH001', N'Trần Tùng Mi', N'Cà Mau', N'Nữ', '079123753951', '0909050505', N'Việt Nam'),
('KH002', N'Nguyễn Khắc Huy', N'Long An', N'Nam', '079456259756', '0166813513',	N'Việt Nam'),
('KH003', N'Nguyễn Thị Thương Nguyên', N'Đắk Lắk', N'Nữ','079789236458','0957893151', N'Việt Nam'),
('KH004', N'Phan Thụy Thanh Quyên',	N'TP.HCM', N'Nữ','079147789456', '0136954782', N'Mỹ'),
('KH005', N'Nguyễn Văn Trình', N'Bình Định', N'Nam', '079258125469', '0269754621', N'Việt Nam'),
('KH006', N'Lê Hồng Thanh Tiên', N'Tây Ninh', N'Nữ', '079369784213', '0365799111', N'Việt Nam'),
('KH007', N'Nguyễn Thị Thùy Trang',	N'Phan Thiết', N'Nữ', '079159456852', '0257964121', N'Việt Nam'),
('KH008', N'Hà Thị Minh Thư', N'Bình Phước', N'Nữ',	'079357123657',	'0902634567', N'Pháp'),
('KH009', N'Trần Phan Vinh Sang', N'Lâm Đồng', N'Nam', '079412751364', '0938156792', N'Campuchia'),
('KH010', N'Đặng Thị Phương Thùy', N'Đà Lạt', N'Nữ',' 079632024568', '0123674951', N'Việt Nam');
GO

SET DATEFORMAT DMY
@
INSERT INTO PHIEUDANGKY
VALUES
('PDK01','KH001','NV009','14/02/2022','25/02/2022',	'VPP003','1000000', 'VND','PDV01'),
('PDK02','KH002','NV011','26/02/2022','17/03/2022',	'VP002', '500000', 'VND','PDV02'),
('PDK03','KH003','NV011','14/05/2022','15/05/2022',	'VP003', '200000', 'VND',NULL),
('PDK04','KH004','NV015','20/03/2022','27/03/2022',	'BT003', '500000', 'VND',NULL),
('PDK05','KH005','NV016','30/03/2022','02/04/2022',	'BT004', '500000', 'VND','PDV03'),
('PDK06','KH006','NV010','15/08/2022','20/08/2022',	'BT005', '400000', 'VND','PDV04'),
('PDK07','KH007','NV012','24/12/2022','26/12/2022',	'VPP003', '1200000', 'VND',NULL);	
GO

SELECT* FROM PHIEUDICHVU
INSERT INTO PHIEUDICHVU
VALUES
('PDV01', 'PDK01', N'Spa', '750000'),
('PDV02', 'PDK02', N'Karaoke', '250000'),
('PDV03', 'PDK05', N'Make Up', '400000'),
('PDV04', 'PDK06', N'Giặt Ủi','150000'),
('PDV05', 'PDK06', N'Giặt Ủi', '150000');
GO

---------------CÀI ĐẶT RÀNG BUỘC TOÀN VẸN---------------
--CHECK
--RÀNG BUỘC GIAPHONG >= 0
ALTER TABLE PHONG
ADD CONSTRAINT CHK_GIAPHONG CHECK (GIAPHONG >= 0)

--VÍ DỤ THỎA
UPDATE PHONG
SET GIAPHONG = 555000
WHERE MAPHONG = 'VP001'

--VÍ DỤ KHÔNG THỎA
UPDATE PHONG
SET GIAPHONG = -555000
WHERE MAPHONG = 'VP001'

--RÀNG BUỘC SOTIENTRATRUOC >= 0
ALTER TABLE HOADON
ADD CONSTRAINT CHK_SOTIENTRATRUOC CHECK (SOTIENTRATRUOC >= 0)

--VÍ DỤ THỎA
UPDATE HOADON
SET SOTIENTRATRUOC = 333333
WHERE MAHD = 'HD005'

--VÍ DỤ KHÔNG THỎA
UPDATE HOADON
SET SOTIENTRATRUOC = -333333
WHERE MAHD = 'HD005'

--RÀNG BUỘC TRATRUOC >= 0
ALTER TABLE PHIEUDANGKY
ADD CONSTRAINT CHK_TRATRUOC CHECK (TRATRUOC >= 0)

--VÍ DỤ THỎA
UPDATE PHIEUDANGKY
SET TRATRUOC = 110000
WHERE MAPDK = 'PDK07'

--VÍ DỤ KHÔNG THỎA
UPDATE PHIEUDANGKY
SET TRATRUOC = -110000
WHERE MAPDK = 'PDK07'

--RÀNG BUỘC GIADV >= 0
ALTER TABLE PHIEUDICHVU
ADD CONSTRAINT CHK_GIADV CHECK (GIADV >= 0)

--VÍ DỤ THỎA
UPDATE PHIEUDICHVU
SET GIADV = 500000
WHERE MAPHIEUDV = 'PDV02'

--VÍ DỤ KHÔNG THỎA
UPDATE PHIEUDICHVU
SET GIADV = -500000
WHERE MAPHIEUDV = 'PDV02'

--DEFAULT
--RÀNG BUỘC MẶC ĐỊNH TÌNH TRẠNG PHÒNG LÀ TRỐNG
ALTER TABLE PHONG
ADD CONSTRAINT DF_TINHTRANG DEFAULT N'Trống' FOR TINHTRANG

--VÍ DỤ
INSERT INTO PHONG(MAPHONG, TENPHONG, MALP, GIAPHONG, DVT)
VALUES
('VP007', N'Phòng 444','VP','1000000','VND');


SELECT * FROM PHONG
GO
--UNIQUE
--RÀNG BUỘC MỖI KHÁCH HÀNG CHỈ CÓ 1 CCCD, SĐT DUY NHẤT
ALTER TABLE KHACHHANG
ADD CONSTRAINT UNI_CCCD_SDT UNIQUE (CCCD, SDT)

--VÍ DỤ THỎA
INSERT INTO KHACHHANG
VALUES
('KH011', N'Nguyễn Phương Nam', N'Hà Nội', N'Nam', '079123755555', '0123456789', N'Việt Nam');
GO

SELECT * FROM KHACHHANG
GO
--VÍ DỤ KHÔNG THỎA (KHÔNG THỎA VÌ TRÙNG CCCD VÀ SDT CỦA KH001)
INSERT INTO KHACHHANG
VALUES
('KH011', N'Nguyễn Thị Lan Hương', N'Hà Nội', N'Nữ', '079123753951', '0909050505', N'Việt Nam');
GO
--TRIGGER
--RÀNG BUỘC DỮ LIỆU NHẬP VÀO HOẶC CẬP NHẬT NGÀY ĐẶT PHẢI NHỎ HƠN NGÀY ĐI
CREATE TRIGGER KT_NGAYDAT_NGAYDI ON PHIEUDANGKY
FOR INSERT, UPDATE
AS
	IF (SELECT NGAYDAT FROM INSERTED) < (SELECT NGAYDI FROM INSERTED) 
		COMMIT TRAN
	ELSE
		BEGIN
			PRINT N'NGÀY ĐẶT PHẢI NHỎ HƠN NGÀY ĐI!!!'
			ROLLBACK TRAN
		END;
GO
--VÍ DỤ THỎA
INSERT INTO PHIEUDANGKY(MAPDK, NGAYDAT, NGAYDI)
VALUES
('PDK08', '22/01/2022','23/01/2022');
GO

SELECT * FROM PHIEUDANGKY
GO
--VÍ DỤ KHÔNG THỎA
INSERT INTO PHIEUDANGKY(MAPDK, NGAYDAT, NGAYDI)
VALUES
('PDK08', '25/04/2022','20/04/2022');
GO
--RÀNG BUỘC KHI THÊM NHÂN VIÊN MỚI THÌ ĐỘ TUỔI PHẢI (18 <= TUỔI <= 55)
CREATE TRIGGER KT_TUOI ON NHANVIEN
FOR INSERT
AS
	DECLARE @AGE INT; --KHAI BÁO BIẾN AGE CHỨA TUỔI CỦA NHÂN VIÊN
	SELECT @AGE = DATEDIFF(YEAR, NGAYSINH, GETDATE()) FROM INSERTED --LẤY RA TUỔI CỦA NV
	IF (@AGE >= 18 AND @AGE <= 55)
		COMMIT TRAN
	ELSE
		BEGIN
			PRINT N'TUỔI NHÂN VIÊN PHẢI >= 18 VÀ <= 55'
			ROLLBACK TRAN
		END;
GO
--VÍ DỤ THỎA
INSERT INTO NHANVIEN
VALUES
('NV020', N'Nguyễn Mai Linh', 'PV', N'Nữ', '23/02/2000', N'155 Lê Trọng Tấn, P. Tây Thạnh Q. Tân Phú, TP. HCM', '0873383213');
GO

SELECT * FROM NHANVIEN
GO
--VÍ DỤ KHÔNG THỎA
INSERT INTO NHANVIEN
VALUES
('NV020', N'Nguyễn Mai Linh', 'PV', N'Nữ', '23/02/2006', N'155 Lê Trọng Tấn, P. Tây Thạnh Q. Tân Phú, TP. HCM', '0873383213');
GO

---------------------TRUY VẤN DỮ LIỆU-------------------

--CÂU 1 liệt kê danh sách (MAKH, HOTENKH, QUOCTICH) khách hàng quốc tịch VN
SELECT MAKH, HOTENKH, QUOCTICH
FROM KHACHHANG
WHERE QUOCTICH = N'VIỆT NAM'

--CÂU 2 cho biết những phòng còn trống
SELECT *
FROM PHONG
WHERE TINHTRANG = N'TRỐNG'

--CÂU 3 cho biết ten khách hàng trả trước trên 300000
SELECT HOTENKH
FROM KHACHHANG, PHIEUDANGKY
WHERE KHACHHANG.MAKH = PHIEUDANGKY.MAKH AND TRATRUOC > 300000

--CÂU 4 CHO BIẾT THÔNG TIN KHÁCH HÀNG KHÔNG CÓ MAPHIEUDV
SELECT KH.*
FROM KHACHHANG KH
LEFT JOIN PHIEUDANGKY PDK ON KH.MAKH = PDK.MAKH
WHERE MAPHIEUDV IS NULL

--CÂU 5 CHO BIẾT SỐ LẦN THANH TOÁN CỦA NHAN VIÊN >= 2
SELECT NV.MANV, TENNV, COUNT(HD.MANV) AS 'SỐ LẦN THANH TOÁN'
FROM HOADON HD, NHANVIEN NV
WHERE HD.MANV = NV.MANV
GROUP BY NV.MANV, TENNV
HAVING COUNT(HD.MANV) >=2

--CÂU 6 CHO BIẾT THÔNG TIN NHÂN VIÊN CHỨC VỤ PHỤC VỤ
SELECT NV.*
FROM NHANVIEN NV
INNER JOIN CHUCVU CV ON NV.MACV = CV.MACV
WHERE TENCV = N'PHỤC VỤ'

--CÂU 7 CHO BIẾT MAKH, TENDV ĐÃ SỬ DỤNG DỊCH VỤ
SELECT PDK.MAKH, PDV.TENDV
FROM PHIEUDANGKY PDK
RIGHT JOIN PHIEUDICHVU PDV ON PDK.MAPDK = PDV.MAPDK

--CÂU 8 kết hợp tên nhân viên và tên chức vụ thành một tập hợp kết quả
SELECT MANV 'MANV + MAKH', TENNV 'TENNV + TENKH'
FROM NHANVIEN
UNION
SELECT MAKH, HOTENKH
FROM KHACHHANG

--CÂU 9 CHO BIẾT MANV NHÂN VIÊN CHƯA ĐƯỢC PHÂN CÔNG THANH TOÁN HÓA ĐƠN
SELECT MANV FROM NHANVIEN
EXCEPT
SELECT MANV FROM HOADON

--CÂU 10 CHO BIẾT MANV NHÂN VIÊN ĐƯỢC PHÂN CÔNG THANH TOÁN HÓA ĐƠN
SELECT MANV FROM NHANVIEN
INTERSECT
SELECT MANV FROM HOADON

--CÂU 11 CHO BIẾT HOTEN VA NGAYDI CUA KHACHANG SAU NGAY 17/3/2022
SELECT HOTENKH, NGAYDI 
FROM KHACHHANG, PHIEUDANGKY
WHERE KHACHHANG.MAKH = PHIEUDANGKY.MAKH AND NGAYDI > '17/03/2022'

--CÂU 12 CHO BIẾT TÊN NHÂN VIÊN CÓ CHỨC VỤ 'QL' VÀ GIỚI TÍNH NAM
SELECT TENNV
FROM NHANVIEN
WHERE MACV = 'QL' AND GIOITINH = 'NAM'

--CÂU 13 CHO BIẾT TÊN KHÁCH HÀNG VÀ MÃ PHÒNG Ở PHÒNG 'VIP1'
SELECT HOTENKH, PH.MALP
FROM KHACHHANG KH, LOAIPHONG LP, PHONG PH, PHIEUDANGKY PDK
WHERE KH.MAKH = PDK.MAKH AND PDK.MAPHONG = PH.MAPHONG AND PH.MALP = LP.MALP AND TENLP = 'VIP1' 

--CÂU 14 LIỆT KÊ CÁC PHÒNG CÓ GIÁ > 200000
SELECT MAPHONG, TENPHONG
FROM PHONG
WHERE GIAPHONG > 200000

--CÂU 15 CHO BIẾT THÔNG TIN CỦA NHÂN VIÊN TÊN Nguyễn Minh Trí
SELECT*
FROM NHANVIEN
WHERE TENNV =N'Nguyễn Minh Trí'

--CÂU 16 CHO BIẾT MÃ NHÂN VIÊN, TÊN NHÂN VIÊN VÀ SĐT CỦA NHÂN VIÊN Ở TP.HCM
SELECT MANV, TENNV, SDT,DCHI
FROM NHANVIEN
WHERE DCHI LIKE N'%TP.HCM'

--CÂU 17 CHO BIẾT NHỮNG NHÂN VIÊN SINH TRONG THÁNG 5
SELECT MANV, TENNV
FROM NHANVIEN 
WHERE MONTH (NGAYSINH) = 5

--CÂU 18 CHO BIẾT TÊN VÀ MÃ CHỨC VỤ CỦA NHÂN VIÊN THANH TOÁN HOA DON 'HD007'
SELECT TENNV, MACV
FROM NHANVIEN NV, HOADON HD
WHERE NV.MANV = HD.MANV AND MAHD = 'HD007'

--CÂU 19 CHO BIẾT PHÒNG CÓ GIÁ CAO NHẤT
SELECT MAPHONG, TENPHONG
FROM PHONG
WHERE GIAPHONG >= ALL(SELECT GIAPHONG FROM PHONG)

--CÂU 20 CHO BIẾT MÃ NHÂN VIÊN, TÊN NHÂN VIÊN THANH TOÁN TRÊN 2 HÓA ĐƠN
SELECT NHANVIEN.MANV,TENNV
FROM NHANVIEN,HOADON
WHERE NHANVIEN.MANV=HOADON.MANV
GROUP BY NHANVIEN.MANV,TENNV
HAVING	COUNT(*)>2

-- CÂU 21 tìm tổng thể khách hàng có họ nguyễn
SELECT*
FROM KHACHHANG
WHERE HOTENKH LIKE N'NGUYỄN%'

--CÂU 22 Tìm tất cả người dùng đã đặt phòng từ 20/03/2022,27/03/2022 
SELECT*
FROM PHIEUDANGKY
WHERE NGAYDAT='20/03/2022' AND NGAYDI='27/03/2022'

-- CÂU 23 cho biết thông tin khách hàng đã thuê khách sạn có mã phòng VPP003
SELECT KH.*
FROM KHACHHANG KH, PHIEUDANGKY PDK, PHONG PH
WHERE KH.MAKH = PDK.MAKH AND PDK.MAPHONG = PH.MAPHONG AND PH.MAPHONG='VPP003'

--CÂU 24 CHO BIẾT DANH SÁCH CÁC PHÒNG ĐANG SỬ DỤNG 
SELECT*
FROM PHONG
WHERE TINHTRANG=N'Đang Sử Dụng' 
-- CÂU 25 TỔNG HỢP THÔNG TIN VỀ PHÒNG CÓ GIÁ THẤP NHẤT
SELECT*
FROM PHONG
WHERE GIAPHONG IN(SELECT MIN(GIAPHONG)FROM PHONG)
--CÂU 26 CHO BIẾT THÔNG TIN KHÁCH HÀNG Ở BÌNH ĐỊNH
SELECT*
FROM KHACHHANG
WHERE DIACHI=N'Bình Định'
-- CÂU 27 CHO BIẾT TẤT CẢ THÔNG TIN CỦA NHÂN VIÊN ĐỀU LÀ NỮ
SELECT*
FROM NHANVIEN
WHERE GIOITINH=N'Nữ'
--câu 28 cho biết tất cả các loại dịch vụ KARAOKE CÓ GIÁ BAO NHIÊU
select TENDV,GIADV
from PHIEUDICHVU
WHERE TENDV=N'Karaoke' AND GIADV='250000'

-- CÂU 29 CHO BIẾT TÊN NHÂN VIÊN SINH NGÀY 23/04/1993
SELECT TENNV,NGAYSINH
FROM NHANVIEN
WHERE NGAYSINH='23/04/1993'


